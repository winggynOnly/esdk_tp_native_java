<ul class="block">
	<li>
		<div id="querySitesByCondition_desc" class="description_div">
			<!-- append description -->
		</div>
	</li>
</ul>
<ul>
	<li>
		<div id="querySitesByCondition_execution">
			<!-- append execution code -->
		</div>
	</li>
</ul>
<ul>
	<li>
		<div id="querySitesByCondition_src" class="sourcecode_div">
			<!-- append source code -->
		</div>
	</li>
</ul>

<script type="text/javascript">
	$(document).ready(function(){
		$.ajax({
			type : "get",
			cache : false,
			url : getServerPath()+"/pages/description/querySitesByCondition_desc.html",
			async : false,
			success : function(data) {
				$("#querySitesByCondition_desc").html(data);
			}
		});
		
		$.ajax({
			type : "get",
			cache : false,
			url : getServerPath()+"/pages/execution/querySitesByCondition_execution.html",
			async : false,
			success : function(data) {
				$("#querySitesByCondition_execution").html(data);
			}
		});
		
		$.ajax({
			type : "get",
			cache : false,
			url : getServerPath()+"/pages/sourcecode/querySitesByCondition_src.html",
			async : false,
			success : function(data) {
				$("#querySitesByCondition_src").html(data);
			}
		});
		
		$("#querySitesByCondition").click(function(){
			$("#numberPerPageErrTip").html("");
			$("#currentPageErrTip").html("");
			$("#focusItemErrTip").html("");
	
			
			$("#numberPerPageErrTip").removeAttr("languageTag");
			$("#currentPageErrTip").removeAttr("languageTag");
			$("#focusItemErrTip").removeAttr("languageTag");

			
			$("#numberPerPage").removeClass("input_error");
			$("#currentPage").removeClass("input_error");
			$("#focusItem").removeClass("input_error");

			
			var numberPerPage = $("#numberPerPage").val();
			var currentPage = $("#currentPage").val();
			var focusItem = $("#focusItem").val();

			var sortItems = new Array();
			var sortItemsData = $("#querySitesByCondition_addSortItem_table tbody tr");
			for(var i = 0; i < sortItemsData.size() - 1; i++){
				var sortItemData = sortItemsData.eq(i).find(".input_in_table");
				var sortItem = {};

				sortItem.sort = sortItemData.eq(0).val();
				sortItem.itemIndex = sortItemData.eq(1).val();
		
				sortItems.push(sortItem);
			}
			
			var filterItems = new Array();
			var filterItemsData = $("#querySitesByCondition_addStringFilter_table tbody tr");
			for(var i = 0; i < filterItemsData.size() - 1; i++){
				var filterItemData = filterItemsData.eq(i).find(".input_in_table");
				var filterItem = {};

				filterItem.columnIndex = filterItemData.eq(0).val();
				filterItem.value = filterItemData.eq(1).val();

				filterItems.push(filterItem);
			}
			
			//参数校验 开始
			if (isEmpty(numberPerPage))
			{
				$("#numberPerPageErrTip").attr("languageTag", "numberPerPageNull");
				$("#numberPerPageErrTip").html(controller.language.titles["numberPerPageNull"]);
				$("#numberPerPage").focus();
				$("#numberPerPage").addClass("input_error");
				return false;
			}
			
			if (!isNumber(numberPerPage))
			{
				$("#numberPerPageErrTip").attr("languageTag", "numberPerPageError");
				$("#numberPerPageErrTip").html(controller.language.titles["numberPerPageError"]);
				$("#numberPerPage").focus();
				$("#numberPerPage").addClass("input_error");
				return false;
			}
			
			if (isEmpty(currentPage))
			{
				$("#currentPageErrTip").attr("languageTag", "currentPageNull");
				$("#ncurrentPageErrTip").html(controller.language.titles["currentPageNull"]);
				$("#currentPage").focus();
				$("#currentPage").addClass("input_error");
				return false;
			}
			
			if (!isNumber(currentPage))
			{
				$("#currentPageErrTip").attr("languageTag", "currentPageError");
				$("#ncurrentPageErrTip").html(controller.language.titles["currentPageError"]);
				$("#currentPage").focus();
				$("#currentPage").addClass("input_error");
				return false;
			}

			if (!isEmpty(focusItem) && !isNumber(focusItem))
			{
				$("#focusItemErrTip").attr("languageTag", "focusItemError");
				$("#focusItemErrTip").html(controller.language.titles["focusItemError"]);
				$("#focusItem").focus();
				$("#focusItem").addClass("input_error");
				return false;
			}
			//参数校验 结束
			
			$.ajax({
				url : getServerPath()+"/querySitesByConditionServlet",
				type : "post",
				dataType : "json",
				data : "numberPerPage=" + numberPerPage + "&currentPage=" + currentPage + "&focusItem=" + focusItem
						 + "&sortItems=" + JSON.stringify(sortItems)
						 + "&filters=" + JSON.stringify(filterItems),
				async : false,
				success : function(data)
				{
					var response = JSON.parse(data)
					$("#querySitesByCondition_resultCode").val(response.resultCode);
					$("#querySitesByCondition_resultContext").val(JSON.stringify(response.result));
				},
				error : function(data)
				{
					$("#querySitesByCondition_resultCode").val(res);
					$("#querySitesByCondition_resultContext").val("");
					
				},
				beforeSend : function()
				{
					$("#querySitesByCondition_resultCode").val("");
					$("#querySitesByCondition_resultContext").val("");
				}
			});
		});
	});
	
</script>